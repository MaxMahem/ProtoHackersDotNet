<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
						 xmlns:md="https://github.com/whistyun/Markdown.Avalonia.Tight"
						 xmlns:ctxt="clr-namespace:ColorTextBlock.Avalonia;assembly=ColorTextBlock.Avalonia"
						 xmlns:ia="using:Avalonia.Xaml.Interactivity"
						 xmlns:mv="using:ProtoHackersDotNet.GUI.MainView"
						 xmlns:behave="using:ProtoHackersDotNet.GUI.Behaviors"
						 xmlns:ci="using:ProtoHackersDotNet.Servers.Interface.Client"
             x:Class="ProtoHackersDotNet.GUI.MainView.MainView"
             x:DataType="mv:MainViewModel"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450">
  <Design.DataContext>
    <mv:MainViewModel />
  </Design.DataContext>
	<Grid ColumnDefinitions="*, 1, 4*, 0" Name="MainGrid">
		<DockPanel Name="Server">
			<DockPanel DockPanel.Dock="Top">
				<Label DockPanel.Dock="Left" Target="{Binding #TypeDropdown}" Classes="h1">Server</Label>
				<ComboBox Name="TypeDropdown" HorizontalAlignment="Right"
									ItemsSource="{Binding AvaliableServers}" SelectedItem="{Binding ServerFactory}"
									IsEnabled="{Binding !ServerRunning}">
					<ComboBox.ItemTemplate>
						<DataTemplate>
							<TextBlock Text="{Binding Name}"/>
						</DataTemplate>
					</ComboBox.ItemTemplate>
				</ComboBox>
			</DockPanel>
			<StackPanel DockPanel.Dock="Bottom">
				<Grid ColumnDefinitions="1*, 2*" RowDefinitions="auto, auto">
					<Label    Grid.Column="0" Grid.Row="0" Target="{Binding #ServerIP}" 
										VerticalAlignment="Center" Classes="h2">IP</Label>
					<ComboBox Grid.Column="1" Grid.Row="0" Name="ServerIP" 
										HorizontalAlignment="Stretch" Classes="mono"
										ItemsSource="{Binding SystemIPs}" SelectedItem="{Binding ServerIP}"
										IsEnabled="{Binding !ServerRunning}" />
					<Label         Grid.Column="0" Grid.Row="1" Target="{Binding #ServerPort}" 
												 VerticalAlignment="Center" Classes="h2">Port</Label>
					<NumericUpDown Grid.Column="1" Grid.Row="1" Name="ServerPort" 
												 ShowButtonSpinner="False" Classes="mono"
												 Value="{Binding ServerPort}" Minimum="0" Maximum="65535" FormatString="0"
												 IsEnabled="{Binding !ServerRunning}" />
				</Grid>
				<StackPanel Orientation="Horizontal" FlowDirection="RightToLeft" 
										Width="{Binding #Server.Bounds.Width}" Spacing="4">
					<Button Command="{Binding StopServer}"  IsEnabled="{Binding !CanServerStart}">Stop</Button>
					<Button Command="{Binding Test}" IsEnabled="{Binding !CanServerStart}">Test</Button>
					<Button Command="{Binding StartServer}" IsEnabled="{Binding CanServerStart}">Start</Button>
				</StackPanel>
			</StackPanel>
			<Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}" BorderThickness="1" CornerRadius="3">
				<md:MarkdownScrollViewer Markdown="{Binding ServerFactory.Description}">
					<md:MarkdownScrollViewer.Styles>
						<Style Selector="ctxt|CTextBlock.Heading1">
							<Setter Property="FontSize" Value="18"/>
							<Setter Property="FontWeight" Value="Bold"/>
						</Style>
						<Style Selector="ctxt|CTextBlock.Heading2">
							<Setter Property="FontSize" Value="16"/>
							<Setter Property="FontWeight" Value="Bold"/>
						</Style>
						<Style Selector="ctxt|CTextBlock.Heading3">
							<Setter Property="FontSize" Value="14"/>
							<Setter Property="FontWeight" Value="Bold"/>
							<Setter Property="Foreground" Value="{DynamicResource TextControlForeground}" />
						</Style>
					</md:MarkdownScrollViewer.Styles>
				</md:MarkdownScrollViewer>
			</Border>
		</DockPanel>
		<GridSplitter Grid.Column="1" ResizeDirection="Columns" MinWidth="2" Margin="5 5"/>
		<Grid Grid.Column="2" ColumnDefinitions="*" RowDefinitions="Auto, 1, *">
			<Expander Grid.Column="0" Grid.Row="0" Name="ClientExpander" HorizontalAlignment="Stretch"
								MinHeight="0" Padding="0" Classes="client"
								MaxHeight="{Binding #MaxExpander.Bounds.Height}"
								Header="{Binding ActiveClientCount^, StringFormat='Clients (Active {0})'}">
				<DockPanel>
					<Button DockPanel.Dock="Bottom" HorizontalAlignment="Right" Command="{Binding ClearClients}">Clear Clients</Button>
					<Border BorderThickness="1" CornerRadius="0 0 3 3"
									BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}">
						<DockPanel>
							<Grid DockPanel.Dock="Top" ColumnDefinitions="3*, *, *, *, *">
								<Label Grid.Column="0" Classes="h2 header">Source</Label>
								<Label Grid.Column="1" Classes="h2 header" HorizontalContentAlignment="Center">Status</Label>
								<Label Grid.Column="2" Classes="h2 header" HorizontalContentAlignment="Right">Age</Label>
								<Label Grid.Column="3" Classes="h2 header" HorizontalContentAlignment="Right">Recieved</Label>
								<Label Grid.Column="4" Classes="h2 header" HorizontalContentAlignment="Right">Transmitted</Label>
							</Grid>
							<ListBox ItemsSource="{Binding Clients}">
								<ListBox.DataTemplates><mv:ClientDataTemplate/></ListBox.DataTemplates>
								<Interaction.Behaviors><behave:ScrollToEndListBoxBehavior/></Interaction.Behaviors>
							</ListBox>
						</DockPanel>
					</Border>
				</DockPanel>
			</Expander>
			<GridSplitter Grid.Column="0" Grid.Row="1"></GridSplitter>
			<DockPanel Grid.Column="0" Grid.Row="2">
				<DockPanel DockPanel.Dock="Bottom" Name="MessageControls">
					<Button DockPanel.Dock="Right" Command="{Binding ClearMessages}">Clear Messages</Button>
					<StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
						<Label VerticalAlignment="Center" Target="{Binding #LogToggle}">Message Logging</Label>
						<ToggleSwitch Name="LogToggle" IsChecked="{Binding LoggingEnabled}" IsEnabled="{Binding !ServerRunning}" />
						<TextBlock Text="{Binding LogFileName}" Margin="5 0 0 0" VerticalAlignment="Center" />
					</StackPanel>
				</DockPanel>
				<TextBlock DockPanel.Dock="Top" Margin="16 8 0 8" Classes="h2"
									 Text="{Binding MessageCount^, StringFormat='Messages ({0})'}" />
				<Border DockPanel.Dock="Bottom" BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}" BorderThickness="1" CornerRadius="3">
					<TreeDataGrid Source="{Binding Messages}">
						<Interaction.Behaviors><behave:ScrollToEndTreeDataGridBehavior/></Interaction.Behaviors>
						<TreeDataGrid.Styles>
						</TreeDataGrid.Styles>
						<TreeDataGrid.Resources>
							<DataTemplate x:Key="TimestampCell" x:DataType="mv:FormatedMessage">
								<TextBlock Text="{Binding Timestamp}" FontFamily="{StaticResource Monospace}" VerticalAlignment="Center" />
							</DataTemplate>
							<DataTemplate x:Key="MessageCell" x:DataType="mv:FormatedMessage">
								<TextBlock Text="{Binding Message}" />
							</DataTemplate>
						</TreeDataGrid.Resources>
					</TreeDataGrid>					
				</Border>
			</DockPanel>
		</Grid>
		<Grid Grid.Column="0" Grid.Row="3" RowDefinitions="1*, 2*" ColumnDefinitions="0">
			<Grid Grid.Column="0" Grid.Row="0" Name="MaxExpander" />
			<Grid Grid.Column="0" Grid.Row="1"/>
		</Grid>
	</Grid>
</UserControl>
